import { useToken } from 'wagmi'
import * as dayjs from 'dayjs'
import * as relativeTime from 'dayjs/plugin/relativeTime'
import Tooltip from '~/components/Tooltip'
import type { IArcadeQuote } from '~/types'
import BigNumber from 'bignumber.js'

// @ts-ignore
dayjs.extend(relativeTime)

export const ArcadePools = ({ pools }: { pools: Array<IArcadeQuote> }) => {
	return (
		<div>
			<div className="relative flex min-h-[2.625rem] items-center justify-center gap-2 rounded-t-xl border border-b-0 border-[#252525] bg-[#111111] p-2">
				<svg xmlns="http://www.w3.org/2000/svg" width="181" height="20px" viewBox="0 0 181 44" fill="none">
					<path
						fillRule="evenodd"
						clipRule="evenodd"
						d="M170.084 2.87233C169.379 2.93163 168.678 3.02874 167.983 3.16323C167.336 3.29363 166.739 3.43908 166.202 3.5745C165.129 3.85035 164.281 4.07605 163.695 4.24658C163.466 4.30773 163.233 4.34637 162.997 4.36194C162.832 4.39705 162.727 4.36194 162.691 4.30677C162.656 4.2516 162.691 4.14627 162.802 4.01085C162.95 3.82574 163.118 3.65753 163.303 3.5093C164.021 2.95694 164.79 2.4749 165.6 2.06984C166.189 1.77136 166.794 1.50514 167.411 1.27237C168.159 0.986526 168.927 0.755209 169.708 0.58023L170.029 0.515027L170.365 0.449825C170.586 0.409701 170.822 0.369576 171.057 0.349514L171.78 0.279297H172.547C173.093 0.285187 173.638 0.333819 174.177 0.424748C174.77 0.529006 175.35 0.69717 175.907 0.926301C176.513 1.18411 177.081 1.52145 177.598 1.92941L177.793 2.0899L177.984 2.26545L178.174 2.44099C178.189 2.45598 178.205 2.47096 178.22 2.48602L178.22 2.48624C178.267 2.53161 178.314 2.57768 178.355 2.62656C178.375 2.65073 178.414 2.69211 178.46 2.74152L178.46 2.74191C178.538 2.82578 178.637 2.93267 178.706 3.01778C178.78 3.1084 178.804 3.13838 178.827 3.16934C178.833 3.17636 178.838 3.18344 178.844 3.19129C178.85 3.20054 178.858 3.21085 178.867 3.22341L179.027 3.43908L179.172 3.65475L179.173 3.65482C179.223 3.73003 179.273 3.80524 179.318 3.88546L179.388 3.9958C179.407 4.03588 179.429 4.07445 179.453 4.11116L179.579 4.34689L179.694 4.58764L179.754 4.70801L179.804 4.82838L179.915 5.07414L180.01 5.31991L180.055 5.44529L180.095 5.5757L180.181 5.82647L180.251 6.07725C180.258 6.12349 180.27 6.16887 180.286 6.21267L180.316 6.33806L180.376 6.59385L180.436 6.85466L180.461 6.98506V7.11546L180.502 7.38129C180.599 8.07572 180.641 8.77674 180.627 9.47778C180.613 10.1811 180.556 10.8829 180.456 11.5793C180.243 12.9868 179.908 14.373 179.453 15.7221C178.976 17.1058 178.412 18.4577 177.763 19.7696C177.09 21.1245 176.341 22.4406 175.521 23.7119C172.091 29.0157 167.713 33.642 162.606 37.3591C161.382 38.2413 160.109 39.0551 158.794 39.7967C157.519 40.5178 156.199 41.1561 154.842 41.7076C153.519 42.2387 152.151 42.65 150.754 42.9364C150.064 43.0725 149.365 43.1663 148.663 43.2173C147.96 43.2774 147.254 43.2774 146.551 43.2173L146.05 43.1571L145.789 43.1169L145.528 43.0668L145.268 43.0166L145.007 42.9564C144.945 42.9384 144.884 42.9216 144.823 42.9049C144.714 42.8754 144.608 42.8463 144.505 42.811C144.163 42.7029 143.828 42.5739 143.502 42.4248C143.342 42.3496 143.181 42.2743 143.026 42.1891L142.795 42.0536L142.564 41.9132C142.269 41.7241 141.989 41.5128 141.727 41.2813C141.592 41.172 141.465 41.0548 141.345 40.9302C141.259 40.8472 141.175 40.7539 141.092 40.6615L141.09 40.6601C141.058 40.6244 141.026 40.5888 140.994 40.554C140.567 40.0583 140.209 39.5065 139.931 38.9139C139.671 38.3716 139.474 37.8011 139.344 37.2137C139.222 36.6811 139.145 36.1392 139.113 35.5936V34.089C139.122 33.8573 139.144 33.6262 139.179 33.3968C139.186 33.2839 139.201 33.1716 139.224 33.0608C139.224 32.9728 139.241 32.8907 139.258 32.8099C139.264 32.7848 139.269 32.7598 139.274 32.7348C139.41 31.9455 139.599 31.1663 139.841 30.4026C140.071 29.7104 140.312 29.0985 140.553 28.5569C140.908 27.7237 141.346 26.9288 141.862 26.1845C141.996 25.9833 142.154 25.7996 142.333 25.6378C142.459 25.5225 142.559 25.4823 142.619 25.5124C142.679 25.5425 142.715 25.6479 142.72 25.8134C142.714 26.0496 142.685 26.2848 142.634 26.5155C142.566 26.9 142.457 27.3927 142.327 27.9761C142.256 28.2985 142.178 28.6485 142.098 29.0233C141.992 29.565 141.882 30.1668 141.787 30.8239C141.686 31.5254 141.626 32.2321 141.606 32.9404V34.3749L141.631 34.6758C141.637 34.7736 141.651 34.8708 141.671 34.9667L141.716 35.2626C141.784 35.6557 141.881 36.043 142.007 36.4212C142.136 36.7959 142.304 37.1558 142.509 37.4945C142.708 37.8284 142.949 38.1352 143.226 38.4074L143.447 38.603L143.493 38.6406L143.493 38.6407C143.555 38.6916 143.613 38.7392 143.678 38.7835C143.837 38.9009 144.004 39.0065 144.179 39.0995C144.979 39.5164 145.865 39.7429 146.767 39.7616C147.27 39.7746 147.773 39.7477 148.272 39.6813C148.821 39.6106 149.365 39.5067 149.902 39.3703C151.064 39.0689 152.198 38.6696 153.292 38.1766C154.474 37.6459 155.621 37.0429 156.728 36.3711C156.967 36.2267 157.205 36.0798 157.441 35.9304L144.129 27.5592V11.1233L158.398 3.77058L172.652 11.1233V20.5488C173.186 19.6998 173.688 18.8309 174.157 17.944C174.767 16.7982 175.304 15.6156 175.767 14.403C176.201 13.2842 176.537 12.1296 176.77 10.9523C176.881 10.4075 176.96 9.85645 177.006 9.30223C177.041 8.78623 177.041 8.26844 177.006 7.75244C176.949 6.87153 176.695 6.01458 176.263 5.24467C176.24 5.20106 176.213 5.15916 176.183 5.11928L176.103 4.98888C176.048 4.90863 175.988 4.82838 175.927 4.75315C175.59 4.29254 175.159 3.90805 174.664 3.62466C174.318 3.43669 173.953 3.287 173.575 3.17827C172.437 2.87885 171.257 2.77539 170.084 2.87233ZM156.091 29.5805L148.633 25.0665V16.6906L156.091 21.1293V29.5805ZM151.131 12.8387L158.423 8.99676L166.012 12.8487L158.423 17.0918L151.131 12.8387ZM160.54 29.5905V21.1394L168.128 16.6906V25.0665L160.54 29.5905ZM84.926 20.9332C84.926 14.9145 88.8582 10.0244 94.611 10.0244C95.9284 9.9975 97.2356 10.2603 98.4403 10.7941C99.645 11.328 100.718 12.1199 101.583 13.114V3.55938H106.277V31.3755H101.798V28.7524C100.889 29.7479 99.7762 30.5352 98.5349 31.0607C97.2936 31.5861 95.9534 31.8372 94.606 31.7968C88.8582 31.7968 84.926 26.9368 84.926 20.9332ZM101.583 20.9332C101.583 17.2568 99.135 14.5484 95.7947 14.5484C92.2437 14.5484 89.7058 17.2568 89.7058 20.9332C89.7058 24.6096 92.2437 27.2728 95.7947 27.2728C99.0899 27.2728 101.583 24.6547 101.583 20.9332ZM17.6225 3.9806H12.9731L0.629883 31.3754H5.62034L7.77701 26.6408H22.8236L24.9803 31.3754H29.9707L17.6225 3.9806ZM18.0037 15.6467L21.1334 22.7487H9.46223L12.5919 15.6467C13.8207 12.8982 15.3003 9.26697 15.3003 9.26697C15.3003 9.26697 16.82 12.9434 18.0037 15.6467ZM35.4229 10.451H30.7534L30.7333 31.3608H35.4229V22.8344C35.4229 17.3424 38.382 15.1406 42.9913 15.1406V10.0247C38.5124 10.0247 36.2304 12.4773 35.4229 14.5939V10.451ZM42.8705 20.9328C42.8764 19.4913 43.1668 18.0652 43.7249 16.7362C44.2831 15.4072 45.0981 14.2014 46.1232 13.1879C47.1482 12.1745 48.3633 11.3733 49.6986 10.8304C51.0339 10.2875 52.4633 10.0135 53.9047 10.024H54.005C56.7417 10.0106 59.394 10.9705 61.4882 12.7324L58.5742 16.0728C57.3205 15.0277 55.7205 14.4908 54.0903 14.5681C53.2752 14.5393 52.4623 14.6713 51.6983 14.9567C50.9342 15.2421 50.2338 15.6752 49.6372 16.2313C49.0405 16.7874 48.5593 17.4557 48.221 18.1978C47.8827 18.94 47.6939 19.7415 47.6654 20.5566V20.9529C47.6654 24.544 50.2032 27.2925 54.2157 27.2925C56.085 27.3294 57.9037 26.684 59.3315 25.4769L61.9145 29.0279C59.6791 30.858 56.8686 31.8387 53.9799 31.7964C47.8209 31.7964 42.8705 27.0217 42.8705 20.9328ZM71.1884 10.0246C65.4356 10.0246 61.5034 14.9148 61.5034 20.9334C61.5034 26.937 65.4406 31.797 71.1884 31.797C72.5026 31.8319 73.8084 31.5773 75.0132 31.0512C76.218 30.5251 77.2924 29.7403 78.16 28.7526V31.3757H82.8545V10.4509H78.16V13.1142C77.2951 12.1202 76.2224 11.3282 75.0177 10.7944C73.813 10.2605 72.5058 9.99773 71.1884 10.0246ZM72.3721 14.5486C75.7074 14.5486 78.16 17.257 78.16 20.9334H78.165C78.165 24.6549 75.6723 27.273 72.3721 27.273C68.8161 27.273 66.2832 24.6098 66.2832 20.9334C66.2832 17.257 68.8161 14.5486 72.3721 14.5486ZM111.329 13.2771C109.334 15.3227 108.233 18.0765 108.268 20.9335C108.268 27.8248 113.595 31.7971 119.583 31.8122C122.424 31.7868 125.192 30.9135 127.533 29.3044L125.672 25.8387C123.892 27.0319 121.796 27.6643 119.653 27.6543C116.514 27.6543 113.81 25.9239 113.133 22.5836H128.987C129.064 21.9796 129.106 21.3718 129.113 20.763C129.113 14.8898 124.629 10.0247 119.052 10.0247H118.906C116.049 10.0617 113.324 11.2316 111.329 13.2771ZM122.625 15.5175C123.685 16.4418 124.369 17.7228 124.549 19.1179H113.088C113.725 16.1085 116.092 14.1023 118.796 14.1023C120.202 14.0897 121.565 14.5931 122.625 15.5175ZM130.111 28.8829C130.106 28.4981 130.178 28.1161 130.321 27.7589C130.464 27.4017 130.677 27.0764 130.946 26.8014C131.215 26.5265 131.536 26.3075 131.89 26.1569C132.245 26.0062 132.625 25.927 133.01 25.9238C133.397 25.9058 133.783 25.9645 134.147 26.0965C134.512 26.2285 134.846 26.4311 135.131 26.6928C135.417 26.9544 135.648 27.2699 135.811 27.6211C135.974 27.9724 136.067 28.3524 136.082 28.7393C136.098 29.1263 136.038 29.5126 135.904 29.876C135.77 30.2394 135.565 30.5727 135.302 30.8569C135.039 31.141 134.722 31.3703 134.37 31.5317C134.018 31.693 133.638 31.7831 133.251 31.7969H133.01C132.63 31.8003 132.253 31.7287 131.9 31.5863C131.548 31.4439 131.227 31.2335 130.956 30.9671C130.685 30.7007 130.469 30.3835 130.321 30.0336C130.172 29.6838 130.094 29.3081 130.091 28.9281L130.111 28.8829Z"
						fill="#E1E8EA"
					/>
				</svg>

				<a
					href={pools[0].loanUrl}
					target="_blank"
					rel="noreferrer noopener"
					className="absolute right-0 top-1 bottom-1 my-auto mx-6 flex flex-nowrap items-center justify-center gap-1 rounded-xl border border-[#252525] p-2 text-xs font-light"
				>
					<Tooltip content="View Collection">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="h-4 w-4">
							<path
								fillRule="evenodd"
								d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z"
								clipRule="evenodd"
							/>
						</svg>
					</Tooltip>
				</a>
			</div>
			<div className="overflow-x-auto rounded-b-xl">
				<table className="w-full min-w-[43.75rem] table-fixed border-collapse rounded-xl bg-[#010101]">
					<thead className="h-[2.625rem] bg-[#111111]">
						<tr>
							<th className="border border-[#252525] p-2 text-sm font-normal text-[#989898]">Principal</th>
							<th className="border border-[#252525] p-2 text-sm font-normal text-[#989898]">Duration</th>
							<th className="border border-[#252525] p-2 text-sm font-normal text-[#989898]">Interest</th>
							<th className="border border-[#252525] p-2 text-sm font-normal text-[#989898]">Expiry</th>
						</tr>
					</thead>
					<tbody>
						{pools.map((pool, index) => (
							<Pool key={Object.values(pool).join('') + index} pool={pool} />
						))}
					</tbody>
				</table>
			</div>
		</div>
	)
}

const Pool = ({ pool }: { pool: IArcadeQuote }) => {
	const { data } = useToken({ address: pool.borrowableToken, chainId: 1 })

	return (
		<tr className="h-[2.625rem]">
			<td className="border border-[#252525] p-2 text-center text-sm">
				{data &&
					`${Number(new BigNumber(pool.principal).div(10 ** data.decimals).toString()).toLocaleString(undefined, {
						maximumFractionDigits: 2
					})} ${data.symbol}`}
			</td>

			<td className="border border-[#252525] p-2 text-center text-sm">
				{/* @ts-ignore */}
				{dayjs(Date.now() + pool.loanDuration * 1000).toNow(true)}
			</td>

			<td className="border border-[#252525] p-2 text-center text-sm">{pool.interestRate}%</td>

			<td className="border border-[#252525] p-2 text-center text-sm">
				<Tooltip content={new Date(Number(pool.offerDeadline) * 1000).toLocaleString()}>
					<span className="mx-auto">{new Date(Number(pool.offerDeadline) * 1000).toLocaleDateString()}</span>
				</Tooltip>
			</td>
		</tr>
	)
}
